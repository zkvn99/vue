<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>todo-app</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <style>
    :root {
      --border-color: #d4d4d4;
      --accent-color: #3b82f6;
      --accent-color-soft: #eff4ff;
      --text-main: #222;
      --text-sub: #777;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 24px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f3f4f6;
      color: var(--text-main);
    }

    .todo-app {
      max-width: 420px;
      margin: 32px auto;
      background: #ffffff;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      padding: 16px 18px 18px;
    }

    .todo-header-title {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .todo-header-title h2 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
    }

    .todo-header-title span {
      font-size: 11px;
      color: var(--text-sub);
    }

    .todo-header {
      display: flex;
      gap: 6px;
      margin-bottom: 10px;
    }

    .todo-header input {
      flex: 1;
      padding: 6px 8px;
      border-radius: 3px;
      border: 1px solid var(--border-color);
      font-size: 13px;
    }

    .todo-header input:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 1px var(--accent-color-soft);
    }

    .todo-header button {
      padding: 6px 10px;
      font-size: 13px;
      border-radius: 3px;
      border: 1px solid var(--accent-color);
      background: var(--accent-color);
      color: #fff;
      cursor: pointer;
      white-space: nowrap;
    }

    .todo-header button:hover {
      background: #2563eb;
      border-color: #2563eb;
    }

    .todo-summary {
      margin: 4px 0 10px;
      font-size: 12px;
      color: var(--text-sub);
    }

    .todo-summary strong {
      font-weight: 600;
      color: var(--accent-color);
    }

    hr {
      border: none;
      border-top: 1px solid #e5e7eb;
      margin: 10px 0;
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .todo-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 4px 0;
      font-size: 13px;
    }

    .todo-main {
      display: flex;
      align-items: center;
      gap: 6px;
      flex: 1;
      min-width: 0;
    }

    .todo-check {
      width: 14px;
      height: 14px;
      border-radius: 3px;
      border: 1px solid var(--border-color);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      flex-shrink: 0;
    }

    .todo-check-inner {
      width: 8px;
      height: 8px;
    }

    .todo-check.done {
      border-color: var(--accent-color);
      background: var(--accent-color-soft);
    }

    .todo-check.done .todo-check-inner {
      background: var(--accent-color);
    }

    .todo-text {
      cursor: pointer;
      user-select: none;
      word-break: break-all;
    }

    .todo-text.done {
      text-decoration: line-through;
      color: var(--text-sub);
    }

    .todo-item button {
      margin-left: 8px;
      padding: 2px 6px;
      font-size: 11px;
      border-radius: 3px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      color: #6b7280;
      cursor: pointer;
      flex-shrink: 0;
    }

    .todo-item button:hover {
      background: #f3f4f6;
    }

    .actions {
      display: flex;
      justify-content: flex-end;
      margin-top: 8px;
    }

    .clear-btn {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 3px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      color: #6b7280;
      cursor: pointer;
    }

    .clear-btn:hover {
      background: #f3f4f6;
    }
  </style>
</head>
<body>
<!--
  종합 실습
  1) ref / reactive / computed / v-model / v-if / v-for / 이벤트 사용
  2) watch를 이용해 로컬스토리지에 저장
-->

<div id="app" class="todo-app">
  <div class="todo-header-title">
    <h2>할 일 목록</h2>
    <span>간단한 Vue 3 예제</span>
  </div>

  <!-- 입력 영역 -->
  <div class="todo-header">
    <input
        type="text"
        v-model.trim="newTodo"
        placeholder="할 일을 입력한 뒤 Enter"
        @keyup.enter="addTodo"
    >
    <button @click="addTodo">추가</button>
  </div>

  <!-- 남은 할 일 수 -->
  <p class="todo-summary" v-if="todos.length > 0">
    남은 할 일 <strong>{{ remainingCount }}</strong> / {{ todos.length }}
  </p>
  <p class="todo-summary" v-else>
    등록된 할 일이 없습니다.
  </p>

  <hr>

  <!-- 할 일 목록 -->
  <ul>
    <li
        v-for="todo in todos"
        :key="todo.id"
        class="todo-item"
    >
      <div class="todo-main">
        <div
            class="todo-check"
            :class="{ done: todo.done }"
            @click="toggleTodo(todo.id)"
        >
          <div class="todo-check-inner"></div>
        </div>
        <span
            class="todo-text"
            :class="{ done: todo.done }"
            @click="toggleTodo(todo.id)"
        >
                    {{ todo.text }}
                </span>
      </div>
      <button @click="removeTodo(todo.id)">삭제</button>
    </li>
  </ul>

  <hr>

  <div class="actions">
    <button class="clear-btn" @click="clearDone">
      완료 항목 모두 삭제
    </button>
  </div>
</div>

<script>
  const { createApp, ref, computed, watch } = Vue;

  createApp({
    setup() {
      // 새 할 일 입력 값
      const newTodo = ref('');

      // 할 일 목록
      const todos = ref([
        { id: 1, text: 'Vue 설치하기', done: true },
        { id: 2, text: '기본 문법 연습하기', done: false }
      ]);

      // 남은 할 일 수 계산
      const remainingCount = computed(() =>
        todos.value.filter(todo => !todo.done).length
      );

      const addTodo = () => {
        if (!newTodo.value) return; // 입력 양식에 값이 있을 경우만 추가 작업 실행

        const nextId =
            todos.value.length === 0 ?
                1 : Math.max(...todos.value.map(t => t.id)) + 1;

        todos.value.push({
          id : nextId,
          text : newTodo.value,
          done : false
        });

        newTodo.value = '';
      };

      const toggleTodo = (id) => {
        const target = todos.value.find(t => t.id === id);
        if(!target) return;
        target.done = !target.done;
      };

      const removeTodo = (id) => {
        todos.value = todos.value.filter(t => t.id !== id);
      };

      const clearDone = () => {
        todos.value = todos.value.filter(t => !t.done);
      };

      // watch를 이용해 todos가 바뀔 때마다 localStorage에 저장
      watch(
          todos,
          (newTodos) => {
            localStorage.setItem('vue-todos', JSON.stringify(newTodos));
          },
          { deep : true } // 객체 내부의 속성 변경까지 감지
      )

      // 페이지 로드 시 localStorage에 저장된 값이 있으면 불러오기
      const saved = localStorage.getItem('vue-todos');
      if(saved) {
        todos.value = JSON.parse(saved);
      }

      return {
        newTodo,
        todos,
        remainingCount,
        addTodo,
        toggleTodo,
        removeTodo,
        clearDone
      };
    }
  }).mount('#app');
</script>
</body>
</html>